apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ../../base

patches:
  - target:
      kind: Deployment
      name: octopub-audit-deployment
    path: octopub-audits-deployment-mysql.yaml
  - target:
      kind: Service
      name: octopub-audit-cluster-ip
    path: octopub-audits-service-mysql.yaml
  - target: 
      kind: Ingress
      name: octopub-ingress
    path: octopub-ingress.yaml
  - target:
      kind: Service
      name: octopub-products-deployment
    path: octopub-products-deployment-mysql.yaml
  - target:
      kind: Deployment
      name: octopub-products-service
    path: octopub-products-service-mysql.yaml
  - target:
      kind: Service
      name: octopub-productservice-cluster-ip
    path: octopub-frontend-service.yaml
  - target:
      kind: Deployment
      name: octopub-frontend-deployment
    path: octopub-frontend-deployment.yaml

images:
- name: octopussamples/octopub-audit-microservice-mysql
  newTag: "#{Octopus.Action.Package[octopussamples/octopub-audit-microservice].PackageVersion}"
  newName: "#{Octopus.Action.Package[octopussamples/octopub-audit-microservice].Image}"
- name: octopussamples/octopub-products-microservice-mysql
  newTag: "#{Octopus.Action.Package[octopussamples/octopub-products-microservice].PackageVersion}"
  newName: "#{Octopus.Action.Package[octopussamples/octopub-products-microservice].Image}"
- name: octopussamples/octopub-frontend
  newTag: "#{Octopus.Action.Package[octopussamples/octopub-frontend].PackageVersion}"
  newName: "#{Octopus.Action.Package[octopussamples/octopub-frontend].Image}"